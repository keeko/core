<?xml version="1.0" encoding="UTF-8"?>
<database defaultIdMethod="native" name="keeko" namespace="keeko\core\model"
	defaultPhpNamingMethod="phpname" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="http://xsd.propelorm.org/1.6/database.xsd">

	<!-- <behavior name="listener"> <parameter name="table" value="iuf_listener"/> 
		<parameter name="phpName" value="Listener"/> </behavior> -->


	<table name="language" namespace="\keeko\core\model">
		<column name="id" type="INTEGER" primaryKey="true" required="true"
			autoIncrement="true" />
		<column name="alpha_2" type="VARCHAR" size="2" />
		<column name="alpha_3T" type="VARCHAR" size="3" />
		<column name="alpha_3B" type="VARCHAR" size="3" />
		<column name="alpha_3" type="VARCHAR" size="3" />
		<column name="local_name" type="VARCHAR" size="128" />
		<column name="en_name" type="VARCHAR" size="128" />
		<column name="collate" type="VARCHAR" size="10" />
		<column name="scope_id" type="INTEGER" size="10" />
		<column name="type_id" type="INTEGER" size="10" />

		<foreign-key foreignTable="language_scope">
			<reference local="scope_id" foreign="id" />
		</foreign-key>
		<foreign-key foreignTable="language_type">
			<reference local="type_id" foreign="id" />
		</foreign-key>
	</table>

	<table name="language_scope" namespace="\keeko\core\model">
		<column name="id" type="INTEGER" primaryKey="true" required="true"
			autoIncrement="true" />
		<column name="name" type="VARCHAR" />
	</table>

	<table name="language_type" namespace="\keeko\core\model">
		<column name="id" type="INTEGER" primaryKey="true" required="true"
			autoIncrement="true" />
		<column name="name" type="VARCHAR" />
	</table>

	<table name="localization" namespace="\keeko\core\model">
		<column name="id" type="INTEGER" primaryKey="true" required="true"
			autoIncrement="true" />
		<column name="parent_id" type="INTEGER" size="10" />
		<column name="language_id" type="INTEGER" size="10" />
		<column name="country_iso_nr" type="INTEGER" size="10" />
		<column name="is_default" type="BOOLEAN" />

		<foreign-key foreignTable="localization">
			<reference local="parent_id" foreign="id" />
		</foreign-key>
		<foreign-key foreignTable="language">
			<reference local="language_id" foreign="id" />
		</foreign-key>
		<foreign-key foreignTable="country">
			<reference local="country_iso_nr" foreign="iso_nr" />
		</foreign-key>
	</table>

	<table name="country" namespace="\keeko\core\model">
		<column name="iso_nr" type="INTEGER" primaryKey="true"
			required="true" />
		<column name="alpha_2" type="CHAR" size="2" />
		<column name="alpha_3" type="CHAR" size="3" />
		<column name="ioc" type="CHAR" size="3" />
		<column name="capital" type="VARCHAR" size="128" />
		<column name="tld" type="VARCHAR" size="3" />
		<column name="phone" type="VARCHAR" size="16" />
		<column name="territory_iso_nr" type="INTEGER" required="true" />
		<column name="currency_iso_nr" type="INTEGER" required="true" />
		<column name="official_local_name" type="VARCHAR" size="128" />
		<column name="official_en_name" type="VARCHAR" size="128" />
		<column name="short_local_name" type="VARCHAR" size="128" />
		<column name="short_en_name" type="VARCHAR" size="128" />
		<column name="bbox_sw_lat" type="FLOAT" />
		<column name="bbox_sw_lng" type="FLOAT" />
		<column name="bbox_ne_lat" type="FLOAT" />
		<column name="bbox_ne_lng" type="FLOAT" />

		<foreign-key foreignTable="territory">
			<reference local="territory_iso_nr" foreign="iso_nr" />
		</foreign-key>
		<foreign-key foreignTable="currency">
			<reference local="currency_iso_nr" foreign="iso_nr" />
		</foreign-key>
	</table>

	<table name="territory" namespace="\keeko\core\model">
		<column name="iso_nr" type="INTEGER" primaryKey="true"
			required="true" />
		<column name="parent_iso_nr" type="INTEGER" />
		<column name="name_en" type="VARCHAR" size="45" required="true" />
	</table>

	<table name="currency" namespace="\keeko\core\model">
		<column name="iso_nr" type="INTEGER" primaryKey="true"
			required="true" />
		<column name="iso3" type="CHAR" size="3" required="true" />
		<column name="en_name" type="VARCHAR" size="45" />
		<column name="symbol_left" type="VARCHAR" size="45" />
		<column name="symbol_right" type="VARCHAR" size="45" />
		<column name="decimal_digits" type="INTEGER" />
		<column name="sub_divisor" type="INTEGER" />
		<column name="sub_symbol_left" type="VARCHAR" size="45" />
		<column name="sub_symbol_right" type="VARCHAR" size="45" />
	</table>

	<table name="subdivision" namespace="\keeko\core\model">
		<column name="id" type="INTEGER" primaryKey="true" required="true"
			autoIncrement="true" />
		<column name="iso" type="VARCHAR" size="45" />
		<column name="name" type="VARCHAR" size="128" />
		<column name="local_name" type="VARCHAR" size="128" />
		<column name="en_name" type="VARCHAR" size="128" />
		<column name="alt_names" type="VARCHAR" size="255" />
		<column name="parent_id" type="INTEGER" />
		<column name="country_iso_nr" type="INTEGER" required="true" />
		<column name="subdivision_type_id" type="INTEGER" />

		<foreign-key foreignTable="country">
			<reference local="country_iso_nr" foreign="iso_nr" />
		</foreign-key>
		<foreign-key foreignTable="subdivision_type">
			<reference local="subdivision_type_id" foreign="id" />
		</foreign-key>
	</table>

	<table name="subdivision_type" namespace="\keeko\core\model">
		<column name="id" type="INTEGER" primaryKey="true" required="true"
			autoIncrement="true" />
		<column name="name" type="VARCHAR" size="128" />
	</table>

	<table name="package" namespace="\keeko\core\model">
		<column name="id" type="INTEGER" primaryKey="true" required="true"
			autoIncrement="true" />
		<column name="name" type="VARCHAR" />
		<column name="title" type="VARCHAR" />
		<column name="description" type="LONGVARCHAR" />
		<column name="installed_version" type="VARCHAR" size="50" />
	</table>

	<table name="application" namespace="\keeko\core\model">
		<behavior name="concrete_inheritance">
			<parameter name="extends" value="package" />
		</behavior>
		<column name="class_name" type="VARCHAR" size="255" required="true" />
	</table>

	<table name="application_uri" namespace="\keeko\core\model">
		<column name="id" type="INTEGER" size="10" primaryKey="true"
			required="true" autoIncrement="true" />
		<column name="httphost" type="VARCHAR" size="255" required="true" />
		<column name="basepath" type="VARCHAR" size="255" required="true" />
		<column name="secure" type="BOOLEAN" />
		<column name="application_id" type="INTEGER" size="10"
			required="true" />
		<column name="localization_id" type="INTEGER" size="10"
			required="true" />

		<foreign-key foreignTable="application" onDelete="restrict">
			<reference local="application_id" foreign="id" />
		</foreign-key>
		<foreign-key foreignTable="localization" onDelete="restrict">
			<reference local="localization_id" foreign="id" />
		</foreign-key>
	</table>

	<table name="module" namespace="\keeko\core\model">
		<behavior name="concrete_inheritance">
			<parameter name="extends" value="package" />
		</behavior>
		<column name="class_name" type="VARCHAR" size="255" required="true" />
		<column name="activated_version" type="VARCHAR" size="50" />
		<column name="default_action" type="VARCHAR" />
		<column name="slug" type="VARCHAR" />
		<column name="has_api" type="BOOLEAN" default="false" phpName="Api" />
	</table>

	<table name="action" namespace="\keeko\core\model">
		<column name="id" type="INTEGER" size="10" primaryKey="true"
			required="true" autoIncrement="true" />
		<column name="name" type="VARCHAR" required="true" />
		<column name="title" type="VARCHAR" required="true" />
		<column name="description" type="VARCHAR" size="255" />
		<column name="class_name" type="VARCHAR" size="255" required="true" />
		<column name="module_id" type="INTEGER" size="10" required="true" />

		<foreign-key foreignTable="module" onDelete="cascade">
			<reference local="module_id" foreign="id" />
		</foreign-key>
	</table>

	<table name="configuration" namespace="\keeko\core\model">
		<column name="key" type="VARCHAR" size="255" primaryKey="true" required="true"/>
		<column name="value" type="LONGVARCHAR"/>
	</table>

	<table name="api" namespace="\keeko\core\model">
		<column name="id" type="INTEGER" size="10" primaryKey="true"
			required="true" autoIncrement="true" />
		<column name="route" type="VARCHAR" required="true" />
		<column name="method" type="VARCHAR" required="true" />
		<column name="action_id" type="INTEGER" size="10" required="true" />
		<column name="required_params" type="VARCHAR" size="255" />

		<foreign-key foreignTable="action" onDelete="cascade">
			<reference local="action_id" foreign="id" />
		</foreign-key>
	</table>

	<table name="auth" namespace="\keeko\core\model">
		<column name="token" type="VARCHAR" primaryKey="true" required="true" size="32"/>
		<column name="user_id" type="INTEGER" size="10" required="true" />

		<behavior name="timestampable"></behavior>

		<foreign-key foreignTable="user" onDelete="none">
			<reference local="user_id" foreign="id" />
		</foreign-key>
	</table>

	<table name="user" namespace="\keeko\core\model">
		<column name="id" type="INTEGER" primaryKey="true" required="true"
			autoIncrement="true" size="10"/>
		<column name="login_name" type="VARCHAR" size="100" />
		<column name="password" type="VARCHAR" size="100" />
		<column name="given_name" type="VARCHAR" size="100" />
		<column name="family_name" type="VARCHAR" size="100" />
		<column name="display_name" type="VARCHAR" size="100" />
		<column name="email" type="VARCHAR" size="255"/>
		<column name="country_iso_nr" type="INTEGER" />
		<column name="subdivision_id" type="INTEGER" />
		<column name="address" type="LONGVARCHAR" />
		<column name="address2" type="LONGVARCHAR" />
		<column name="birthday" type="DATE" />
		<column name="sex" type="TINYINT" />
		<column name="city" type="VARCHAR" size="128" />
		<column name="postal_code" type="VARCHAR" size="45" />
		<column name="password_recover_code" type="VARCHAR" size="32" />
		<column name="password_recover_time" type="TIMESTAMP" />
		<column name="location_status" type="TINYINT" size="2" />
		<column name="latitude" type="FLOAT" size="10" />
		<column name="longitude" type="FLOAT" size="10" />

		<behavior name="timestampable"></behavior>

		<behavior name="validate">
			<parameter name="rule1" value="{column: login_name, validator: NotNull}" />
			<parameter name="rule2" value="{column: email, validator: NotNull}" />
			<parameter name="rule3" value="{column: email, validator: Email}" />
			<parameter name="rule4" value="{column: password, validator: NotNull}" />
		</behavior>

		<foreign-key foreignTable="country">
			<reference local="country_iso_nr" foreign="iso_nr" />
		</foreign-key>
		<foreign-key foreignTable="subdivision">
			<reference local="subdivision_id" foreign="id" />
		</foreign-key>

		<unique name="login_name_UNIQUE">
			<unique-column name="login_name" />
		</unique>
	</table>

	<table name="group" namespace="\keeko\core\model">
		<column name="id" type="INTEGER" size="10" primaryKey="true"
			required="true" autoIncrement="true" />
		<column name="owner_id" type="INTEGER" size="10" />
		<column name="name" type="VARCHAR" size="64" />
		<column name="is_guest" type="BOOLEAN" />
		<column name="is_default" type="BOOLEAN" />
		<column name="is_active" type="BOOLEAN" default="1" />
		<column name="is_system" type="BOOLEAN" default="0" />
		
		<behavior name="timestampable"></behavior>
		
		<behavior name="validate">
			<parameter name="rule1" value="{column: name, validator: NotNull}" />
		</behavior>
		
		<!-- <foreign-key foreignTable="user" phpName="Owner" onDelete="restrict">
			<reference local="owner_id" foreign="id" />
		</foreign-key>-->
	</table>

	<table name="group_user" isCrossRef="true" namespace="\keeko\core\model">
		<column name="user_id" type="INTEGER" size="10" primaryKey="true"
			required="true" />
		<column name="group_id" type="INTEGER" size="10" primaryKey="true"
			required="true" />
		<foreign-key foreignTable="group" onDelete="restrict">
			<reference local="group_id" foreign="id" />
		</foreign-key>
		<foreign-key foreignTable="user" onDelete="restrict">
			<reference local="user_id" foreign="id" />
		</foreign-key>
	</table>

	<table name="group_action" isCrossRef="true" namespace="\keeko\core\model">
		<column name="group_id" type="INTEGER" size="10" primaryKey="true"
			required="true" />
		<column name="action_id" type="INTEGER" size="10" primaryKey="true"
			required="true" />
		<foreign-key foreignTable="group" onDelete="restrict">
			<reference local="group_id" foreign="id" />
		</foreign-key>
		<foreign-key foreignTable="action" onDelete="restrict">
			<reference local="action_id" foreign="id" />
		</foreign-key>
	</table>

</database>
